# ðŸ“œ The Backend Contract

**"Ambiguity kills adoption."**
This document strictly defines what you provide and what the system guarantees.

---

## 1. The Input (What You Provide)

You provide **Schema Files** (YAML) in `app/schema/`.

### 1.1 Schema Rules

- **Format:** YAML
- **Location:** `app/schema/`
- **Required Fields:**
  - `name` (PascalCase, e.g., `BlogPost`)
  - `table` (snake_case, e.g., `blog_posts`)
  - `fields` (Dictionary of field definitions)
    - `id`: `{type: uuid, primary: true}`
- **Optional Fields:**
  - `timestamps` (boolean): Adds `created_at`, `updated_at`
  - `soft_delete` (boolean): Adds `deleted_at`

### 1.2 Environmental Config

- **File:** `.env`
- **Required Variables:**
  - `DATABASE_URL` (PostgreSQL connection string)
  - `SECRET_KEY` (For JWT encryption)

---

## 2. The Output (What System Guarantees)

If the Input is valid, the System **guarantees** the following ready states:

### 2.1 HTTP API Surface

For every Model `M`, you get:

- `POST /api/v1/m/` (Create, with Validation)
- `GET /api/v1/m/` (List, with Pagination `skip`/`limit`)
- `GET /api/v1/m/{id}` (Retrieve 404/200)
- `PUT /api/v1/m/{id}` (Update, Partial)
- `DELETE /api/v1/m/{id}` (Delete)

### 2.2 Persistence

- **Database:** PostgreSQL tables governed by Alembic.
- **Migrations:** Deterministic migration files generated by `manage.py migrate`.
- **Primary Keys:** UUIDs generated server-side.

### 2.3 Authentication

- **Standard:** JWT Bearer Token.
- **Identity:** `current_user` injected into request context.
- **Routes:** `/auth/login`, `/auth/register` are pre-built.

### 2.4 Documentation

- **OpenAPI:** `/docs` (Swagger UI) is always live.
- **Schema:** Pydantic models mirrored in OpenAPI schema.

---

## 3. Operational Guarantees

- **Startup:** `manage.py start` handles generation, migration, and execution.
- **Docker:** Container is stateless (data resides in volume).
- **Background Jobs:** `app/services/tasks.py` functions decorated with `@celery_app.task` are automatically worker-ready.
